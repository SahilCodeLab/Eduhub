<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sahil Assignment AI</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex items-center justify-center p-6">

  <div id="root" class="w-full max-w-3xl"></div>

  <script type="text/babel">

    const API = "https://college-notifier-frch.onrender.com";

    function App() {
      const [mode, setMode] = React.useState("assignment");
      const [input, setInput] = React.useState("");
      const [bulkInput, setBulkInput] = React.useState("");
      const [result, setResult] = React.useState("");
      const [loading, setLoading] = React.useState(false);

      const handleGenerate = async () => {
        setLoading(true);
        setResult("");

        let endpoint = "";
        let body = {};
        let isBulk = false;

        if (mode === "assignment") {
          endpoint = "/generate-assignment";
          body = { prompt: input };
        } else if (mode === "short") {
          endpoint = "/generate-short-answer";
          body = { prompt: input };
        } else if (mode === "long") {
          endpoint = "/generate-long-answer";
          body = { prompt: input };
        } else if (mode === "summary") {
          endpoint = "/generate-summary";
          body = { topic: input };
        } else if (mode === "bulk") {
          endpoint = "/generate-bulk-qna";
          isBulk = true;
          const questions = bulkInput.split('\n').filter(Boolean);
          body = { questions };
        }

        try {
          const res = await fetch(`${API}${endpoint}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
          });

          const data = await res.json();
          setResult(data.text || "No result");
        } catch (err) {
          setResult("‚ùå Error generating content.");
        }

        setLoading(false);
      };

      const downloadPDF = async () => {
        let endpoint = "";
        let body = {};

        if (mode === "assignment") {
          endpoint = "/generate-assignment";
          body = { prompt: input };
        } else if (mode === "long") {
          endpoint = "/generate-long-answer";
          body = { prompt: input };
        } else if (mode === "bulk") {
          endpoint = "/generate-bulk-qna";
          const questions = bulkInput.split('\n').filter(Boolean);
          body = { questions };
        } else return alert("PDF download only for Assignment, Long & Bulk!");

        try {
          const res = await fetch(`${API}${endpoint}?download=pdf`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
          });

          const blob = await res.blob();
          const url = window.URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = "Sahil_Assignment.pdf";
          link.click();
        } catch (err) {
          alert("‚ùå PDF download failed.");
        }
      };

      return (
        <div className="bg-white rounded-xl shadow-lg p-6 space-y-4">
          <h1 className="text-2xl font-bold text-center text-indigo-600">üìö Sahil Assignment AI</h1>

          <div className="flex flex-wrap justify-center gap-2">
            {["assignment", "short", "long", "bulk", "summary"].map((type) => (
              <button
                key={type}
                className={`px-3 py-1 rounded-full text-sm ${
                  mode === type ? "bg-indigo-600 text-white" : "bg-gray-200"
                }`}
                onClick={() => {
                  setMode(type);
                  setResult("");
                }}
              >
                {type.toUpperCase()}
              </button>
            ))}
          </div>

          {mode === "bulk" ? (
            <textarea
              rows="6"
              className="w-full border p-2 rounded-md"
              placeholder="Enter multiple questions line by line..."
              value={bulkInput}
              onChange={(e) => setBulkInput(e.target.value)}
            />
          ) : (
            <textarea
              rows="5"
              className="w-full border p-2 rounded-md"
              placeholder="Enter your topic or question..."
              value={input}
              onChange={(e) => setInput(e.target.value)}
            />
          )}

          <div className="flex gap-4 justify-center">
            <button
              onClick={handleGenerate}
              className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg"
              disabled={loading}
            >
              {loading ? "Generating..." : "Generate"}
            </button>
            {(mode === "assignment" || mode === "long" || mode === "bulk") && (
              <button
                onClick={downloadPDF}
                className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg"
              >
                Download PDF
              </button>
            )}
          </div>

          {result && (
            <div className="border p-4 rounded-md bg-gray-50 whitespace-pre-wrap">
              <h3 className="text-md font-semibold mb-2">üß† Result:</h3>
              <p>{result}</p>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>