<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahil's AI Content Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <style>
        body {
            background-color: #f0f2f5;
        }
        .container {
            max-width: 900px;
        }
        .card {
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        #result-container {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            min-height: 200px;
            white-space: normal;
        }
        /* Markdown Styles */
        #result-container h1, #result-container h2, #result-container h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
        }
        #result-container li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>

    <div class="container my-5">
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold">AI Content Generator ðŸ¤–</h1>
            <p class="text-muted">Generate assignments, long answers, and short answers with ease.</p>
        </div>

        <div class="card p-4 mb-4">
            <div class="mb-3">
                <label for="prompt-input" class="form-label fs-5 fw-medium">1. Enter Your Topic or Question</label>
                <textarea class="form-control" id="prompt-input" rows="4" placeholder="e.g., Explain the theory of relativity..."></textarea>
            </div>

            <div class="mb-3">
                <label class="form-label fs-5 fw-medium">2. Choose Content Type</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="generationType" id="type-assignment" value="/generate-assignment" checked>
                    <label class="form-check-label" for="type-assignment">Full Assignment</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="generationType" id="type-long" value="/generate-long-answer">
                    <label class="form-check-label" for="type-long">Long Answer</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="generationType" id="type-short" value="/generate-short-answer">
                    <label class="form-check-label" for="type-short">Short Answer</label>
                </div>
            </div>

            <div class="form-check form-switch mb-4">
                <input class="form-check-input" type="checkbox" role="switch" id="download-pdf-check">
                <label class="form-check-label" for="download-pdf-check">Download as PDF</label>
            </div>

            <button class="btn btn-primary btn-lg" id="generate-btn">
                <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                Generate Content
            </button>
        </div>

        <div class="card">
            <div class="card-header fs-5 fw-medium">
                Generated Result
            </div>
            <div class="card-body">
                 <div id="status-message" class="mb-3"></div>
                <div id="result-container">
                    <p class="text-muted">Your generated content will appear here...</p>
                </div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIGURATION ---
    const backendUrl = 'https://college-notifier-frch.onrender.com';
    const markdownConverter = new showdown.Converter();

    // --- DOM ELEMENTS ---
    const generateBtn = document.getElementById('generate-btn');
    const promptInput = document.getElementById('prompt-input');
    const pdfCheck = document.getElementById('download-pdf-check');
    const resultContainer = document.getElementById('result-container');
    const statusMessage = document.getElementById('status-message');
    const spinner = document.getElementById('spinner');
    const radioButtons = document.querySelectorAll('input[name="generationType"]');

    // --- EVENT LISTENERS ---

    // Disable PDF option for short answers
    radioButtons.forEach(radio => {
        radio.addEventListener('change', (event) => {
            if (event.target.value === '/generate-short-answer') {
                pdfCheck.checked = false;
                pdfCheck.disabled = true;
            } else {
                pdfCheck.disabled = false;
            }
        });
    });

    // Main generate button click handler
    generateBtn.addEventListener('click', async () => {
        const prompt = promptInput.value.trim();
        if (!prompt) {
            showAlert('Please enter a prompt first.', 'warning');
            return;
        }

        const selectedType = document.querySelector('input[name="generationType"]:checked');
        const endpoint = selectedType.value;
        const wantsPdf = pdfCheck.checked;

        let finalUrl = backendUrl + endpoint;
        if (wantsPdf) {
            finalUrl += '?download=pdf';
        }

        // --- UI & API CALL ---
        toggleLoading(true);
        resultContainer.innerHTML = '<p class="text-muted">Generating... Please wait, the first request can take up to a minute.</p>';

        try {
            const response = await fetch(finalUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt }),
            });
            
            const contentType = response.headers.get('content-type');

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'An unknown error occurred.');
            }

            // Handle PDF download
            if (contentType && contentType.includes('application/pdf')) {
                showAlert('PDF is being prepared for download...', 'info');
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = 'assignment.pdf';
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(downloadUrl);
                resultContainer.innerHTML = '<p class="text-success fw-bold">âœ… PDF download has started successfully!</p>';
            } 
            // Handle JSON text response
            else {
                const data = await response.json();
                const htmlContent = markdownConverter.makeHtml(data.text);
                resultContainer.innerHTML = htmlContent;
                showAlert(`Content generated successfully from: ${data.source}`, 'success');
            }

        } catch (error) {
            console.error('API Error:', error);
            showAlert(`Error: ${error.message}`, 'danger');
            resultContainer.innerHTML = '<p class="text-danger">Failed to generate content.</p>';
        } finally {
            toggleLoading(false);
        }
    });


    // --- UTILITY FUNCTIONS ---
    function toggleLoading(isLoading) {
        if (isLoading) {
            spinner.classList.remove('d-none');
            generateBtn.disabled = true;
        } else {
            spinner.classList.add('d-none');
            generateBtn.disabled = false;
        }
    }

    function showAlert(message, type) {
        statusMessage.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
    }
});
</script>

</body>
</html>
